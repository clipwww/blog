---
title: é—œæ–¼æ€éº¼ç”¨ SVG Icon çš„ç ”ç©¶ç´€éŒ„
summary: æƒ³è¦å„ªé›…çš„ä½¿ç”¨ SVG Icon ğŸ¥¹
date: 2023-01-12
tags: 
  - CSS
  - SVG
  - vite-plugin-vue2-svg
---

## Why

å…¬å¸å°ˆæ¡ˆä½¿ç”¨çš„ Icon æ˜¯å¾ figma ä¸‹è¼‰ SVG Icon æ”¾åˆ°å°ˆæ¡ˆä¸­
è‹¥æ˜¯ä¸éœ€è¦æ›´æ”¹é¡è‰²çš„ Icon å¯ä»¥ç›´æ¥ç”¨ img ä¾†å‘ˆç¾

```html
<img src=".../xxx.svg">
```

ä½†ç¸½æ˜¯æœƒæœ‰éœ€è¦æ”¹é¡è‰²çš„æƒ…å¢ƒ (ex: disabled è¦ç”¨ç°è‰²ä¹‹é¡)
ä»¥ img tag çš„æ–¹å¼ä½¿ç”¨ç„¡æ³•æ›´æ”¹é¡è‰²
ç”¨ Inline SVG è¤‡è£½è²¼ä¸Šé†œåˆé›£ç¶­è­·

```vue
<template>
<div>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
      <g fill="none" fill-rule="evenodd">
          ...å¯èƒ½å¾ˆé•·å¾ˆé•·...
      </g>
  </svg>
  ...å…¶ä»– html DOM
</div>
</template>

```

å› æ­¤ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶ `vite-plugin-vue2-svg`ï¼ˆå°ˆæ¡ˆç‚º vite + vue2ï¼‰
å°‡æŒ‡å®šè³‡æ–™å¤¾ä¸­çš„ SVG æª”æ¡ˆæ‰“åŒ…æˆ Vue Component
ä½¿ç”¨æ™‚æœƒ render Inline SVGï¼Œä¾¿å¯é€é `fill: currentColor` + text `color` æ›´æ”¹é¡è‰²

```vue
<template>
  <component :is="svgComponent" :width="width" :height="height" />
</template>

<script lang="ts">
import { defineComponent, defineAsyncComponent } from '@vue/composition-api'

export default defineComponent({
  name: 'SvgIcon',
  props: {
    name: { type: String, required: true },
    width: { type: String },
    height: { type: String, default: '100%' },
  },
  setup(props) {
    const svgComponent = defineAsyncComponent(() => import(`/icons/${props.name}.svg`))

    return {
      svgComponent,
    }
  },
})
</script>

<style lang="scss" scoped>
::v-deep {
  svg:not([fill^='url']),
  path:not([fill^='url']),
  g:not([fill^='url']) {
    fill: currentColor;
  }
}
</style>
```

p.s. vite-plugin-vue2-svg é è¨­æœƒå°‡ viewBox æ‹¿æ‰
é€™æœƒä½¿å¾— icon æ²’è¾¦æ³•ç”¨ width, height æ›´æ”¹å¤§å°
å› æ­¤è¦å°‡ `removeViewBox` è¨­ç‚º `false`

```ts
// vite.config.ts
import { createSvgPlugin } from 'vite-plugin-vue2-svg' // only for vue2.x

export default defineConfig({
  plugins: [
    createSvgPlugin({
      svgoConfig: {
        plugins: [
          {
            // ref. https://github.com/svg/svgo#default-preset
            name: 'preset-default',
            params: {
              overrides: {
                removeViewBox: false,
              },
            },
          },
        ],
      },
    }),
  ]
})
```

ä½† vite-plugin-vue2-svg åªæœ‰ `vue 2` & `vite 2` èƒ½å¤ ä½¿ç”¨
è€ƒæ…®åˆ°æœªä¾†æˆ–è¨±æœƒå‡ç´š vite3 (vue 3)ï¼Œéœ€è¦æ¨æ£„ vite-plugin-vue2-svg
å› æ­¤å°‹æ‰¾èƒ½æ›´å„ªé›…ä½¿ç”¨ SVG Icon çš„æ–¹å¼
å°¤å…¶æ˜¯æƒ³è¦èƒ½å¤ åƒ Font Icon ä¸€æ¨£é€é css class ç°¡å–®å¥½è®€

## Approach

### 1. Font Icon
å¯è—‰ç”± [IcoMoon](http://icomoon.io/app/) æä¾›çš„æœå‹™æŠŠ SVG æ‰“åŒ…æˆ Font Icon

- å„ªé»ï¼š
  - ä¸éœ€è¦å®‰è£é¡å¤–çš„ç¬¬ä¸‰æ–¹å¥—ä»¶
  - èƒ½ä½¿ç”¨ font-size, color èª¿æ•´å¤§å°ã€é¡è‰²
- ç¼ºé»ï¼š
  - ç”±æ–¼æ˜¯ Fontï¼Œæœƒå—åˆ°æ‰€æœ‰è·Ÿ Font æœ‰é—œçš„ css å½±éŸ¿ ( line-height, letter-space ä¹‹é¡ )
  - ä½”ç”¨å½é¡åˆ¥
  - æ¯æ¬¡æœ‰æ–°å¢ Icon éƒ½è¦é‡æ–°ç”Ÿæˆ Font Icon
  - Font Icon ç„¡æ³•é€é VS Code çš„æ’ä»¶ã€ŒSVG Previewã€é è¦½


### 2. SVG Sprite 
å¯è—‰ç”± [SVG Sprites](https://svgsprit.es/) æä¾›çš„æœå‹™æŠŠæ‰€æœ‰ SVG æ‰“åŒ…æˆä¸€å€‹ SVG Sprite æª”æ¡ˆ

- å„ªé»ï¼š
  - ä¸éœ€è¦å®‰è£é¡å¤–çš„ç¬¬ä¸‰æ–¹å¥—ä»¶
  - ç”¨ Inline SVG ä½†å¯«èµ·ä¾†ç°¡çŸ­
```html
<svg>
  <use xlink:href="#{name}"></use>
</svg>
```

- ç¼ºé»ï¼š
  - æ¯æ¬¡æ–°å¢ Icon æ™‚éƒ½è¦é‡æ–°ç”Ÿæˆ SVG Sprite
  - SVG æ•¸é‡è¶Šå¤š Sprite æª”æ¡ˆè¶Šå¤§
  - SVG Sprite ç„¡æ³•é€é VS Code çš„æ’ä»¶ã€ŒSVG Previewã€é è¦½


### 3. Pure CSS Icon
Vue, Vite çš„æ ¸å¿ƒæˆå“¡ï¼Œå¤§ç¥ Anthony Fu çš„é€™ç¯‡æ–‡ [èŠèŠçº¯CSS å›¾æ ‡](https://antfu.me/posts/icons-in-pure-css-zh)
ä½¿ç”¨ css å±¬æ€§ `mask-image` å°‡ SVG ä½œç‚ºé®ç½©åœ–å±¤ä½¿ç”¨
å°‡ background è¨­ç‚º currentColorï¼Œå°±èƒ½å¤ ç”¨ css å±¬æ€§ color å»æ›´æ”¹é¡è‰²
å¯¬é«˜è¨­ç‚º 1em å°±èƒ½å¤ è®“ SVG Icon ä¾æ“š font-size æ”¹è®Šå¤§å°
å¦‚æ­¤ä¾¿æ“æœ‰äº† Font Icon çš„å„ªé»
èƒ½å¤ åƒ Font Icon ä¸€æ¨£ä»¥ css class æŒ‡å®š icon
ä¸”åˆä¸æœƒå—åˆ°å…¶ä»– Font css çš„å½±éŸ¿

ç°¡ç›´å¤ªç¥å•¦ ğŸ™

---

#### Mask-Image æ•ˆæœå±•ç¤º

<div class="flex flex-wrap items-center my-5">
  <img class="w-16" src="https://i.imgur.com/76CtMp0.png"></img>
  <span class="mx-5 text-5xl">+</span>
  <img class="w-24" src="https://i.imgur.com/4Sq6dN0.jpg"></img>
  <span class="mx-5 text-5xl">=</span>
  <div class="mask-logo"></div>
</div>

<style>
  .mask-logo {
    mask-size: 100% 100%;
    mask-repeat: no-repeat;
    mask-image: url("https://i.imgur.com/76CtMp0.png");
    background: 'currentColor';
    width: 250px;
    height: 250px;
    background-image: url("https://i.imgur.com/4Sq6dN0.jpg");
    background-size: cover;
    background-repeat: no-repeat;
  }
</style>

---

ä½†ç‚ºäº†ä½¿ç”¨ Pure CSS Icon é¡å¤–å¼•å…¥ UnoCSS èˆ‡ç›¸é—œå¥—ä»¶åè€Œé•ååŸæœ¬æƒ³ç›¡é‡æ¸›å°‘ç¬¬ä¸‰æ–¹å¥—ä»¶çš„åŸæ„ ğŸ¤”
ä½•æ³å°ˆæ¡ˆå·²ç¶“æœ‰ä½¿ç”¨ `WindiCSS` äº†

æ©ï¼Ÿé‚£ä½•ä¸ä¹¾è„†ç”¨ WindiCSS æä¾›çš„ plugins åŠŸèƒ½
å°‡å°ˆæ¡ˆä¸­çš„ SVG æª”æ¡ˆåƒè€ƒ UnoCSS Pure CSS Icon çš„æ–¹æ³•ç”Ÿæˆå€‹åˆ¥çš„ class

```ts
// windi.config.ts
import { defineConfig } from 'windicss/helpers'
import plugin from 'windicss/plugin'

export default defineConfig({
  plugins: [
    plugin(({ addComponents }) => {
      // TODO: 
    }),
  ],
})
```

é¦–å…ˆæ˜¯å¾æ”¾ç½® SVG çš„ `/icons` è³‡æ–™å¤¾ä¸­è®€å–å…¨éƒ¨ SVG File çš„æª”å

```ts
const svgIcons = fs
  .readdirSync(path.resolve(__dirname, '/icons'))
  .filter(fileName => fileName.includes('.svg'))
  .map(fileName => ({ name: fileName.replace('.svg', ''), url: `/icons/${fileName}` }))

const maskIcons = svgIcons.map(({ name, url }) => ({ className: `.i-mask-${name}`, url }))
const bgIcons = svgIcons.map(({ name, url }) => ({ className: `.i-${name}`, url }))
```

åˆ†æˆ
- maskIconsï¼šç”¨ mask-imageï¼Œå¯ä»¥æ›´æ›é¡è‰²çš„ Icon
å¦‚æœé‡åˆ°ä¸æ”¯æ´ mask-image çš„å‰‡ç”¨ background
```ts
maskIcons.forEach(({ className, url }) => {
  addComponents({
    [className]: {
      display: 'inline-block',
      'background-image': `url("${url}")`,
      'background-repeat': 'no-repeat',
      'background-size': '100% 100%',
      'background-color': 'transparent',
      width: '1em',
      height: '1em',
      '@supports (-webkit-mask-image: url(#mask)) or (mask-image: url(#mask))': {
        'mask-size': '100% 100%',
        'mask-repeat': 'no-repeat',
        'mask-image': `url("${url}")`,
        background: 'currentColor',
      },
    },
  })
})
```
- bgIconsï¼šç”¨ background-imageï¼Œä¸èƒ½æ›´æ›é¡è‰²çš„ Icon
```ts
bgIcons.forEach(({ className, url }) => {
  addComponents({
    [className]: {
      display: 'inline-block',
      'background-image': `url("${url}")`,
      'background-repeat': 'no-repeat',
      'background-size': '100% 100%',
      'background-color': 'transparent',
      height: '1em',
      width: '1em',
    },
  })
})
```

p.s. url çš„éƒ¨åˆ†ä¹Ÿå¯ä»¥è½‰æˆ base64 å­—ä¸²ï¼Œå°‡ SVG å…§å®¹æœ¬èº«ä¸€èµ·æ‰“åŒ…é€² css
ä¸¦ä¸”å¯ä»¥åœ¨è½‰æ›æ™‚åˆ¤æ–·è©² SVG æ˜¯å–®è‰²é‚„æ˜¯å¤šè‰² SVGï¼ˆå¯ä¾æ“š fill æ˜¯ä¸æ˜¯ currentColorï¼‰ï¼Œå–®è‰²çš„å°±å¯ä»¥ä½¿ç”¨ mask-image
é€™æ¨£å°±ä¸éœ€è¦ç”¢ç”Ÿ `i-mask-{name}`ã€`i-{name}` å…©ç¨® class

---

å®Œæˆäº†ä»¥ SVG filename ä½œç‚ºå‘½åçš„ class 
![](https://i.imgur.com/tsoJ3vH.png)
![](https://i.imgur.com/b4XYDHH.png)

- å„ªé»ï¼š
  - ä¸éœ€è¦å®‰è£é¡å¤–çš„ç¬¬ä¸‰æ–¹å¥—ä»¶ ï¼ˆ é™¤äº† WindiCSS
  - èƒ½ä½¿ç”¨ font-size, text color èª¿æ•´å¤§å°ã€é¡è‰²
  - ä¸æœƒå—åˆ°å…¶ä»– font css å±¬æ€§çš„å½±éŸ¿
  - ä¸éœ€è¦ä½”ç”¨å½é¡åˆ¥
  - å¯ä»¥å€‹åˆ¥æ–°å¢/æ›´æ› svg æª”æ¡ˆ
  - å› ç‚ºæ˜¯ classï¼Œä½¿ç”¨ vuetify é€™æ¨£çš„ ui framework æ™‚
    å¯åˆ©ç”¨ `xxx-icon` é€™é¡çš„ props å»æ›¿æ›æˆè‡ªå·±çš„ iconï¼Œå°±ä¸éœ€è¦ç”¨ slot å¦å¤–å¯«äº†

- ç¼ºé»ï¼š
  - mask-image æ”¯æ´åº¦å•é¡Œï¼Œé›–ç„¶ç›®å‰ä¸»æµç€è¦½å™¨çš„æœ€æ–°ç‰ˆéƒ½æœ‰æ”¯æ´


## But

æœ¬ä¾†è¦ºå¾—ä¸€åˆ‡éƒ½å¾ˆé †åˆ©ï¼Œå¯ä»¥ç›´æ¥ç”¨åœ¨å°ˆæ¡ˆä¸Š
å»ç™¼ç¾ä¸€å€‹ mask-image + firefox çš„å·²çŸ¥ render bug
ç”¨äº† mask-image çš„ DOM æœ‰ rotate æ™‚ï¼Œæœƒè·‘å‡ºé æœŸå¤–çš„æ¡†ç·š ğŸ˜­

![](https://i.imgur.com/7KGxRib.png)

2 å¹´å‰å°±æœ‰äººå›å ±ï¼Œä½†é‚„æ²’ä¿®å¥½
https://bugzilla.mozilla.org/show_bug.cgi?id=1671784
https://bugzilla.mozilla.org/show_bug.cgi?id=1764056

é›–ç„¶ Firefox çš„ä½¿ç”¨äººæ•¸ç›¸è¼ƒä¹‹ä¸‹ç®—å°‘
ä½†å·²çŸ¥æœƒæœ‰ Bugï¼Œå°±åªèƒ½æ”¾æ£„ç›´æ¥ç”¨åœ¨å°ˆæ¡ˆä¸Šäº† 


<div class="text-9xl">ğŸ« </div>

åæ­£éƒ½ç ”ç©¶äº†ï¼Œç•™å€‹ç´€éŒ„




